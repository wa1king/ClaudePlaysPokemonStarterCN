# API性能测试工具使用说明

## 文件说明

### 1. `test_api_performance.py` - 完整性能测试工具
- 功能最全面的测试工具
- 可以测试所有模型和配置组合
- 生成详细的性能报告和JSON文件
- 适合深入分析API性能

### 2. `quick_api_test.py` - 快速测试工具 ⭐ 推荐
- 基于配置文件的快速测试
- 预设了推荐的配置组合
- 提供性能对比和优化建议
- 适合日常快速测试

### 3. `api_test_config.py` - 配置文件
- 集中管理所有测试参数
- 可以快速修改API密钥、模型列表等
- 包含推荐的测试配置

## 快速开始

### 方法1: 使用快速测试工具（推荐）
```bash
python quick_api_test.py
```

选择"1"进行快速对比测试，会自动测试以下配置：
- 最快配置: claude-3-haiku-20240307 (512 tokens)
- 平衡配置: claude-3-5-haiku-20241022 (1024 tokens)  
- 当前配置: claude-3-5-sonnet-20241022 (1024 tokens)
- 高质量配置: claude-3-5-sonnet-20241022 (2048 tokens)

### 方法2: 测试单个模型
```bash
python quick_api_test.py
```
选择"2"，然后选择要测试的模型和参数。

### 方法3: 完整性能测试
```bash
python test_api_performance.py
```
选择"1"进行完整测试，会测试所有模型和token配置的组合。

## 测试结果解读

### 性能等级
- 🏆 优秀: ≤ 2秒
- 🥈 良好: ≤ 5秒  
- 🥉 可接受: ≤ 10秒
- 🐌 较慢: > 10秒

### 关键指标
- **平均耗时**: 多轮测试的平均响应时间
- **成功率**: 成功请求的比例
- **Token效率**: 每秒处理的token数量
- **响应质量**: 生成内容的长度和工具调用情况

## 优化建议

### 根据你当前的12.9秒响应时间，推荐尝试：

1. **立即优化**: 切换到 `claude-3-haiku-20240307`
   - 预期提升: 3-5倍速度
   - 响应时间: 2-4秒
   - 质量损失: 轻微

2. **平衡选择**: 使用 `claude-3-5-haiku-20241022`
   - 预期提升: 2-3倍速度
   - 响应时间: 4-6秒
   - 质量: 接近当前水平

3. **Token优化**: 降低max_tokens到512或1024
   - 减少不必要的长响应
   - 提升响应速度

## 配置修改

### 修改游戏中的模型配置
在 `config.py` 中修改：
```python
MODEL_NAME = "claude-3-haiku-20240307"  # 最快
# 或
MODEL_NAME = "claude-3-5-haiku-20241022"  # 平衡

MAX_TOKENS = 1024  # 从默认值降低
```

### 修改测试配置
在 `api_test_config.py` 中可以修改：
- API密钥和基础URL
- 要测试的模型列表
- Token限制选项
- 测试轮数和间隔

## 测试数据说明

测试使用模拟的宝可梦游戏场景：
- 160x144像素的游戏截图
- 包含角色、建筑、道路等游戏元素
- 模拟真实的游戏状态信息
- 使用相同的系统提示和工具定义

## 故障排除

### 常见问题
1. **API密钥错误**: 检查 `api_test_config.py` 中的密钥
2. **网络超时**: 增加 `timeout` 设置
3. **频率限制**: 增加 `request_delay` 间隔
4. **模型不可用**: 检查模型名称是否正确

### 调试模式
在测试文件中设置更详细的错误信息：
```python
TEST_SETTINGS["show_error_details"] = True
```

## 高级用法

### 自定义测试场景
可以修改 `create_test_messages()` 函数来测试不同的游戏场景。

### 批量测试
使用完整测试工具可以一次性测试所有配置组合，适合寻找最优配置。

### 性能监控
定期运行测试可以监控API性能变化，及时调整配置。

---

**建议**: 先运行 `python quick_api_test.py` 选择模式1，快速找到最适合的配置，然后在游戏中应用。